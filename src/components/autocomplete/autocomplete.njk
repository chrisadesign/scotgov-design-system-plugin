<div class="ds_site-search  ds_autocomplete" id="site-search-autocomplete">
    <form role="search" class="ds_site-search__form">
        <label class="ds_label  visually-hidden" for="site-search" id="site-search-label">Search</label>

        <div class="ds_input__wrapper  ds_input__wrapper--has-icon">
            <input
                aria-autocomplete="list"
                aria-expanded="false"
                aria-owns="autocomplete-suggestions"
                autocomplete="off"
                class="ds_input  ds_site-search__input  js-autocomplete-input"
                haspopup="true"
                id="site-search"
                name="q"
                placeholder="Search"
                required=""
                type="search"
            />

            <button type="submit" class="ds_button">
                <span class="visually-hidden">Search</span>
                <svg class="ds_icon" aria-hidden="true" role="img"><use xlink:href="/assets/images/icons/icons.stack.svg#search"></use></svg>
            </button>

            <div id="autocomplete-suggestions" class="ds_autocomplete__suggestions">
                <ol class="ds_autocomplete__suggestions-list" role="listbox" aria-labelledby="site-search-label"></ol>
            </div>
        </div>
    </form>
</div>

<div class="ds_inset-text">
    <div class="ds_inset-text__text">
        <p>Note that for the purposes of this demo we only have a limited dataset. That dataset is:</p>
        <ul>
            <li>Apply for a new blue badge</li>
            <li>Renew a blue badge</li>
            <li>Report a lost, stolen or misused Blue Badge</li>
            <li>Changing or handing back a Blue Badge</li>
            <li>Get further help with a Blue Badge</li>
            <li>Using your Blue Badge</li>
        </ul>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    var searchElement = document.getElementById('site-search');
    var autocomplete = new window.DS.components.Autocomplete(
        document.getElementById('site-search-autocomplete'),
        '/assets/data/autocomplete-dummy-data.json?foo=',
        {
            suggestionMappingFunction: function (suggestionsObj) {
                var responseObj = JSON.parse(suggestionsObj.response).map(suggestionsObj => ({
                    key: suggestionsObj.key,
                    displayText: suggestionsObj.disp,
                    weight: suggestionsObj.wt,
                    type: suggestionsObj.disp_t,
                    category: suggestionsObj.cat
                }));
                return responseObj.filter(item => item.displayText.toLowerCase().indexOf(searchElement.value.toLowerCase()) > -1);
            }
        }
    );

    autocomplete.init();
});
</script>
